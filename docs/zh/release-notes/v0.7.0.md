# Release v0.7.0

## 自动化集成 - JSON 输出格式 + Commit Feedback 参数 + Git 错误建议

本次发布专注于提升自动化能力和开发者体验，新增 JSON 输出支持、命令行反馈参数以及增强的 Git 错误消息。

### JSON 输出格式支持

所有主要命令现在都支持结构化 JSON 输出，使 gcop-rs 可以轻松与其他工具、脚本和 CI/CD 流水线集成。

**新选项：**
- `--format json` - 完整格式指定
- `--json` - `--format json` 的简写

**使用示例：**

```bash
# 生成 commit message 并输出为 JSON
$ gcop-rs commit --json
{
  "success": true,
  "data": {
    "message": "feat: add user authentication module"
  }
}

# 以 JSON 格式审查变更
$ gcop-rs review changes --json
{
  "success": true,
  "data": {
    "review": "...",
    "suggestions": [...]
  }
}

# 以 JSON 格式获取统计信息
$ gcop-rs stats --json
{
  "success": true,
  "data": {
    "total_commits": 150,
    "contributors": 3,
    ...
  }
}

# JSON 格式的错误输出
$ gcop-rs commit --json
{
  "success": false,
  "error": {
    "code": "NO_STAGED_CHANGES",
    "message": "No staged changes found"
  }
}
```

**JSON 模式行为：**
- 自动禁用彩色输出和 UI 进度指示器
- `commit` 命令隐式启用 dry-run 模式
- 错误以结构化格式输出，包含错误码

### Commit Feedback 参数

直接从命令行向 commit message 生成器传递初始指令。

```bash
# 使用 conventional commits 格式
$ gcop-rs commit --feedback "use conventional commits format"

# 指定语言
$ gcop-rs commit --feedback "write in Chinese"

# 添加特定上下文
$ gcop-rs commit --feedback "this is a breaking change, mention migration steps"
```

**使用场景：**
- 脚本和自动化工作流
- 团队内一致的 commit message 风格
- 无需交互式提示的快速一行命令

### Git 错误建议

Git 错误现在附带可操作的建议，帮助你快速解决问题。

**v0.7.0 之前：**
```
Error: reference 'refs/heads/main' not found
```

**v0.7.0 之后：**
```
Error: reference 'refs/heads/main' not found

Suggestion: The branch 'main' does not exist. Try:
  - Check available branches with `git branch -a`
  - Create the branch with `git checkout -b main`
```

**涵盖的错误场景：**
- 仓库状态问题（dirty worktree、unborn branch）
- 合并冲突和 rebase 进行中
- 认证和权限错误
- 网络和远程操作失败
- 引用未找到错误

## 升级说明

从 v0.6.x 升级**无需任何操作**。此版本**完全向后兼容**。

**保持不变的部分：**
- 所有现有 CLI 选项保持不变
- 配置文件格式不变
- 默认行为不变（文本输出）

**新增内容：**
- commit、review、stats 命令的 `--json` / `--format json` 选项
- commit 命令的 `--feedback` 选项
- 带建议的增强错误消息

## 破坏性变更

**无。**这是一个包含新功能的小版本更新。

## 安装

```bash
# Homebrew (macOS/Linux)
brew tap AptS-1547/tap
brew upgrade gcop-rs

# pipx (Python 用户，推荐)
pipx upgrade gcop-rs

# cargo-binstall (无需编译)
cargo binstall gcop-rs

# cargo install (从源码编译)
cargo install gcop-rs --force
```

或从 [Releases](https://github.com/AptS-1547/gcop-rs/releases) 下载预编译二进制。

## 统计数据

- **修改文件数**：14
- **新增行数**：+590
- **删除行数**：-165
- **提交数**：4

## 贡献者

- AptS-1547（卞雨涵 / Yuhan Bian）
- AptS-1548（48）

## 反馈

如有问题或建议，欢迎提交 [Issue](https://github.com/AptS-1547/gcop-rs/issues)。

---

**完整变更日志**：[v0.6.1...v0.7.0](https://github.com/AptS-1547/gcop-rs/compare/v0.6.1...v0.7.0)
