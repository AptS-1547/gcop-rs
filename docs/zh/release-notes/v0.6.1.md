# Release v0.6.1

## Verbose 模式与 Prompt 架构改进

本次发布增强了调试体验，改进了 verbose 输出，并重构了内部 prompt 架构以更好地兼容不同的 LLM provider。

### Verbose 模式现在显示完整 Prompt

`-v` 参数已增强，现在会显示发送给 LLM provider 的完整 prompt，包括 system 和 user 两部分消息。

**v0.6.1 之前：**
```bash
$ gcop-rs -v commit
# 只显示基本调试信息
```

**v0.6.1 之后：**
```bash
$ gcop-rs -v commit
[DEBUG] System message:
You are a professional Git commit message generator...

[DEBUG] User message:
Generate a commit message for the following changes:
...
```

**优势：**
- 当 commit message 不符合预期时，更容易调试
- 准确了解发送给 LLM 的上下文内容
- 有助于自定义 prompt 的开发和测试

> **安全提示：**verbose 输出可能包含你的 diff 代码片段。请勿公开分享 verbose 日志。

### LLM Prompt 架构重构

Prompt 构建系统已重构，现在正确支持 system/user 消息分离：

**现在的工作方式：**

| Provider | System Message | User Message |
|----------|---------------|--------------|
| Claude | 原生 `system` 字段 | `messages[0].content` |
| OpenAI | `messages[0].role = "system"` | `messages[1].role = "user"` |
| Ollama | 合并为单个 prompt | （API 限制） |

**新的 `PromptParts` 结构：**
```rust
pub struct PromptParts {
    pub system: String,  // 上下文、角色、格式说明
    pub user: String,    // 实际的 diff 和请求
}
```

**为什么重要：**
- Claude 和 OpenAI 现在可以利用其原生的 system message 处理
- 更好的上下文分离带来更一致的输出
- Ollama 继续使用合并的 prompt（无破坏性变更）

### 文档更新

- **新增关于页面**：添加项目信息和归属说明
  - `docs/guide/about.md`（英文）
  - `docs/zh/guide/about.md`（中文）
- **更新链接**：文档现在指向新域名
- **Homebrew 安装**：更新了 tap 仓库名称

### 代码质量改进

- 统一所有源文件的代码格式
- 简化测试代码结构，提高可维护性
- 在适当的位置添加 `#[allow(clippy::too_many_arguments)]` 注释

## 升级说明

从 v0.6.0 升级**无需任何操作**。此版本**完全向后兼容**。

**保持不变的部分：**
- 所有公共 API 保持不变
- 配置文件格式不变
- 命令行界面不变

**改进的部分：**
- 使用 `-v` 参数获得更好的调试体验
- 更一致的 LLM 输出（特别是 Claude/OpenAI）

## 破坏性变更

**无。**这是一个补丁版本，仅包含改进。

## 安装

```bash
# Homebrew (macOS/Linux)
brew tap AptS-1547/gcop-rs
brew upgrade gcop-rs

# pipx (Python 用户，推荐)
pipx upgrade gcop-rs

# cargo-binstall (无需编译)
cargo binstall gcop-rs

# cargo install (从源码编译)
cargo install gcop-rs --force
```

或从 [Releases](https://github.com/AptS-1547/gcop-rs/releases) 下载预编译二进制。

## 统计数据

- **修改文件数**：23
- **新增行数**：+552
- **删除行数**：-505
- **提交数**：7

## 贡献者

- AptS-1547（卞雨涵 / Yuhan Bian）
- AptS-1548（48）

## 反馈

如有问题或建议，欢迎提交 [Issue](https://github.com/AptS-1547/gcop-rs/issues)。

---

**完整变更日志**：[v0.6.0...v0.6.1](https://github.com/AptS-1547/gcop-rs/compare/v0.6.0...v0.6.1)
